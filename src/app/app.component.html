<router-outlet></router-outlet>
<mat-toolbar fxLayout fxLayoutAlign="start center" fxLayoutGap="1rem">
  <button mat-icon-button (click)="drawer.toggle()">
    <mat-icon>menu</mat-icon>
  </button>
  <fa-icon [icon]="faGithub" class="logo"></fa-icon>
  <h1 routerLink="/">
    GitHub Issues
  </h1>
  <mat-form-field appearance="outline" floatLabel="never">
    <button matPrefix mat-icon-button aria-label="Search" matTooltip="Search" (click)="fetchGithubIssues()">
      <mat-icon>search</mat-icon>
    </button>
    <input #repobox type="text" matInput class="rounded-field" placeholder="Search issues" matTooltip="user/repository"
      [(ngModel)]="repo" (keydown.enter)="fetchGithubIssues()">
    <button matSuffix mat-icon-button aria-label="Clear search" matTooltip="Clear search" (click)="clearInput(repobox)"
      [hidden]="repobox.value">
      <mat-icon>close</mat-icon>
    </button>
  </mat-form-field>
</mat-toolbar>
<mat-divider></mat-divider>
<mat-drawer-container autosize class="remaining-height">
  <mat-drawer #drawer mode="side" opened="true" class="fixed-width">
    <mat-selection-list #labelsList [multiple]="false">
      <mat-list-option *ngFor="let state of states" [value]="state.name" [matTooltip]="state.name">
        <mat-icon mat-list-icon>{{ state.icon }}</mat-icon>
        {{ state.name | titlecase }}
      </mat-list-option>
    </mat-selection-list>
  </mat-drawer>
  <div class="content">
    <mat-paginator [length]="resultsLength" pageSize="10" hidePageSize></mat-paginator>
    <mat-divider></mat-divider>
    <div class="example-loading-shade" *ngIf="isLoadingResults || isRateLimitReached">
      <mat-spinner *ngIf="isLoadingResults"></mat-spinner>
      <div class="example-rate-limit-reached" *ngIf="isRateLimitReached">
        GitHub's API rate limit has been reached. It will be reset in one minute.
      </div>
    </div>
    <article fxLayout class="fullheight">
      <section fxFlex="50%" class="example-table-container" [ngStyle]="{'opacity': isLoadingResults ? '0.5' : '1'}">
        <table mat-table [dataSource]="dataSource" class="example-table" matSort matSortActive="created"
          matSortDisableClear matSortDirection="desc">
          <ng-container matColumnDef="select" class="checkbox-column">
            <th mat-mat-toolbar-cell *matHeaderCellDef>
              <mat-checkbox (change)="$event ? masterToggle() : null"
                [checked]="selection.hasValue() && isAllSelected()"
                [indeterminate]="selection.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()"
                matTooltip="Select">
              </mat-checkbox>
            </th>
            <td mat-cell *matCellDef="let row">
              <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(row) : null"
                [checked]="selection.isSelected(row)" [aria-label]="checkboxLabel(row)" matTooltip="Select">
              </mat-checkbox>
            </td>
          </ng-container>
          <ng-container matColumnDef="number">
            <th mat-mat-toolbar-cell *matHeaderCellDef>
              Issue #
            </th>
            <td mat-cell *matCellDef="let row" class="issue-number-column">
              {{ row.number }}
            </td>
          </ng-container>
          <ng-container matColumnDef="title">
            <th mat-mat-toolbar-cell *matHeaderCellDef>
              Title
            </th>
            <td mat-cell *matCellDef="let row">
              <div fxLayout fxLayoutAlign="start center" fxLayoutGap="0.4em">
                <mat-chip-list aria-label="Issue state">
                  <mat-chip>{{ row.state }}</mat-chip>
                </mat-chip-list>
                <span>
                  {{ row.title }}
                </span>
              </div>
            </td>
          </ng-container>
          <ng-container matColumnDef="created" [stickyEnd]="true">
            <th mat-mat-toolbar-cell *matHeaderCellDef mat-sort-mat-toolbar disableClear>
              Created
            </th>
            <td mat-cell *matCellDef="let row" class="last-column">
              <span [style.display]="!row.hovered ? 'block' : 'none'">
                {{ row.created_at | date }}
              </span>
              <mat-chip-list [style.display]="row.hovered ? 'block' : 'none'" aria-label="View issue">
                <mat-chip class="gmail-action" (click)="openInNew(row.html_url)">
                  <span>
                    View issue
                  </span>
                  <mat-icon class="icon-display">call_made</mat-icon>
                </mat-chip>
                <button *ngFor="let action of actions" mat-icon-button [attr.aria-label]="action.name | titlecase"
                  [matTooltip]="action.name | titlecase" class="action-button" (click)="action.method(row, action)">
                  <mat-icon>{{ action.icon }}</mat-icon>
                </button>
              </mat-chip-list>
            </td>
          </ng-container>
          <tr mat-mat-toolbar-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; let i = index; columns: displayedColumns;"
            class="example-element-row remove-background" [ngClass]="{'mat-elevation-z2': row.hovered}"
            (mouseover)="handleMouseOver(row)" (mouseout)="handleMouseLeave(row)">
          </tr>
        </table>
      </section>
      <mat-divider vertical="true"></mat-divider>
      <section fxFlex="50%" class="fullheight scroll">
        <pre *ngIf="dataSource?.data" class="plaintext wrap">{{ dataSource?.data | json }}</pre>
      </section>
    </article>
  </div>
</mat-drawer-container>
